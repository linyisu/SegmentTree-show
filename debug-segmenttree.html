<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug SegmentTree</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; border: 1px solid #ff9999; }
        .success { background: #e6ffe6; border: 1px solid #99ff99; }
    </style>
</head>
<body>
    <h1>🔍 SegmentTree 调试器</h1>
    <div id="debug-output"></div>
    
    <script>
        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = 'debug ' + (isError ? 'error' : 'success');
            div.innerHTML = '<strong>' + new Date().toLocaleTimeString() + ':</strong> ' + message;
            document.getElementById('debug-output').appendChild(div);
        }
        
        // 加载主页面并检查
        function loadAndCheck() {
            log('开始加载主页面...');
            
            const iframe = document.createElement('iframe');
            iframe.src = 'SegMentTree.html';
            iframe.style.width = '100%';
            iframe.style.height = '400px';
            iframe.style.border = '1px solid #ccc';
            iframe.style.marginTop = '20px';
            
            iframe.onload = function() {
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // 检查关键元素
                    const fontSlider = doc.getElementById('font-size-slider');
                    const lineSlider = doc.getElementById('line-height-slider');
                    const buildBtn = doc.getElementById('btn-build');
                    
                    log('字体大小滑块: ' + (fontSlider ? '✅ 找到' : '❌ 未找到'));
                    log('行高滑块: ' + (lineSlider ? '✅ 找到' : '❌ 未找到'));
                    log('构建按钮: ' + (buildBtn ? '✅ 找到' : '❌ 未找到'));
                    
                    if (fontSlider) {
                        log('字体滑块值: ' + fontSlider.value);
                        log('字体滑块事件: ' + (fontSlider.oninput ? '有' : '无'));
                    }
                    
                    if (lineSlider) {
                        log('行高滑块值: ' + lineSlider.value);
                        log('行高滑块事件: ' + (lineSlider.oninput ? '有' : '无'));
                    }
                    
                    // 测试函数是否存在
                    const win = iframe.contentWindow;
                    log('changeFontSize函数: ' + (typeof win.changeFontSize === 'function' ? '✅ 存在' : '❌ 不存在'));
                    log('changeLineHeight函数: ' + (typeof win.changeLineHeight === 'function' ? '✅ 存在' : '❌ 不存在'));
                    log('buildTreeVisualization函数: ' + (typeof win.buildTreeVisualization === 'function' ? '✅ 存在' : '❌ 不存在'));
                    
                    // 测试手动调用
                    if (typeof win.changeFontSize === 'function') {
                        try {
                            win.changeFontSize(16);
                            log('✅ 手动调用 changeFontSize(16) 成功');
                        } catch (e) {
                            log('❌ 手动调用 changeFontSize 失败: ' + e.message, true);
                        }
                    }
                    
                } catch (e) {
                    log('❌ 检查过程中出错: ' + e.message, true);
                }
            };
            
            iframe.onerror = function() {
                log('❌ 页面加载失败', true);
            };
            
            document.body.appendChild(iframe);
        }
        
        // 开始检查
        document.addEventListener('DOMContentLoaded', loadAndCheck);
    </script>
</body>
</html>
