<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>线段树最终功能测试</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/tree.css">
    <link rel="stylesheet" href="styles/components.css">
    <style>
        .test-container {
            padding: 20px;
            margin: 20px auto;
            max-width: 1000px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--section-bg);
            border-radius: 8px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-color);
        }
        
        .controls button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #2196f3;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .controls button:hover {
            background: #1976d2;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 线段树区间修改功能最终测试</h1>
        
        <div class="test-section">
            <h2>📊 基本功能测试</h2>
            
            <div class="controls">
                <label>输入数据:</label>
                <input type="text" id="test-input" value="1 2 3 4 5" placeholder="例如: 1 2 3 4 5">
                <button onclick="buildTree()">🚀 构建线段树</button>
                <button onclick="generateRandom()">🎲 随机生成</button>
            </div>
            
            <div class="controls">
                <label>区间修改:</label>
                <span>左端点:</span>
                <input type="number" id="modify-left" value="2" min="1" max="8" style="width: 80px;">
                <span>右端点:</span>
                <input type="number" id="modify-right" value="4" min="1" max="8" style="width: 80px;">
                <span>增加值:</span>
                <input type="number" id="modify-value" value="10" style="width: 80px;">
                <button onclick="applyModification()">⚡ 应用修改</button>
            </div>
            
            <div id="status-display" class="status info">
                ℹ️ 准备就绪，请构建线段树开始测试
            </div>
            
            <div id="tree-container"></div>
        </div>
        
        <div class="test-section">
            <h2>🔄 自适应测试</h2>
            <p>请尝试以下操作来测试自适应功能：</p>
            <ul>
                <li>构建线段树后调整浏览器窗口大小</li>
                <li>使用浏览器缩放功能（Ctrl + +/-）</li>
                <li>在不同屏幕尺寸下查看效果</li>
            </ul>
            
            <div class="controls">
                <button onclick="testResize()">🖥️ 模拟窗口大小变化</button>
                <button onclick="checkState()">🔍 检查当前状态</button>
                <button onclick="clearTree()">🗑️ 清空线段树</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>🎨 颜色层级测试</h2>
            <p>验证不同层级的节点颜色分配：</p>
            <ul>
                <li><span style="color: #6c5ce7;">■</span> 第0层（根节点）- 紫色 (#6c5ce7)</li>
                <li><span style="color: #fd79a8;">■</span> 第1层 - 粉色 (#fd79a8)</li>
                <li><span style="color: #00b894;">■</span> 第2层 - 绿色 (#00b894)</li>
                <li><span style="color: #e17055;">■</span> 第3层 - 橙红色 (#e17055)</li>
            </ul>
            
            <div class="controls">
                <button onclick="buildTestTree(8)">🌳 构建8节点树（测试所有层级）</button>
                <button onclick="buildTestTree(3)">🌿 构建3节点树（测试部分层级）</button>
            </div>
        </div>
    </div>

    <!-- 引入必要的JS文件 -->
    <script src="js/generate_Visualizer_modify.js"></script>
    
    <script>
        let visualizer;
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status-display');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function buildTree() {
            const input = document.getElementById('test-input').value;
            const container = document.getElementById('tree-container');
            
            if (!input.trim()) {
                updateStatus('❌ 请输入数组数据', 'error');
                return;
            }
            
            try {
                if (!visualizer) {
                    visualizer = new window.ModifyTreeVisualizer(container);
                }
                visualizer.buildTreeFromInput(input);
                updateStatus('✅ 线段树构建成功', 'success');
            } catch (error) {
                updateStatus(`❌ 构建失败: ${error.message}`, 'error');
                console.error('构建错误:', error);
            }
        }
        
        function generateRandom() {
            if (window.ModifyTreeVisualizer && window.ModifyTreeVisualizer.generateRandomData) {
                const randomData = window.ModifyTreeVisualizer.generateRandomData();
                document.getElementById('test-input').value = randomData;
                updateStatus('🎲 随机数据已生成', 'info');
            } else {
                updateStatus('❌ 随机生成功能未找到', 'error');
            }
        }
        
        function applyModification() {
            const left = parseInt(document.getElementById('modify-left').value);
            const right = parseInt(document.getElementById('modify-right').value);
            const value = parseInt(document.getElementById('modify-value').value);
            
            if (!visualizer) {
                updateStatus('❌ 请先构建线段树', 'error');
                return;
            }
            
            try {
                visualizer.performRangeUpdate(left, right, value);
                updateStatus(`✅ 区间修改完成: [${left}, ${right}] +${value}`, 'success');
            } catch (error) {
                updateStatus(`❌ 修改失败: ${error.message}`, 'error');
                console.error('修改错误:', error);
            }
        }
        
        function testResize() {
            // 模拟窗口大小变化
            window.dispatchEvent(new Event('resize'));
            updateStatus('🔄 已触发窗口resize事件', 'info');
        }
        
        function checkState() {
            const state = {
                visualizer: !!visualizer,
                isRendered: window.isModifyTreeRendered || false,
                nodeCount: window.modifyDomNodeElements ? window.modifyDomNodeElements.size : 0,
                lastN: window.lastModifyBuiltN || 0
            };
            
            updateStatus(`🔍 状态检查: 可视化器=${state.visualizer}, 已渲染=${state.isRendered}, 节点数=${state.nodeCount}, 数组长度=${state.lastN}`, 'info');
            console.log('当前状态:', state);
        }
        
        function clearTree() {
            if (visualizer) {
                visualizer.clearTree();
                updateStatus('🗑️ 线段树已清空', 'info');
            }
        }
        
        function buildTestTree(n) {
            const testData = Array.from({length: n}, (_, i) => i + 1).join(' ');
            document.getElementById('test-input').value = testData;
            buildTree();
        }
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('ℹ️ 页面加载完成，请开始测试', 'info');
        });
    </script>
</body>
</html>
