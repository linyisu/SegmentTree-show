<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­æ³•é«˜äº®æµ‹è¯•</title>
    <style>
        body {
            background: #1e1e1e;
            color: white;
            font-family: 'JetBrains Mono', monospace;
            padding: 20px;
            line-height: 1.6;
        }
        .code-block {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #e2e8f0;
            padding: 25px;
            border-radius: 16px;
            margin: 25px 0;
            overflow-x: auto;
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .code-block code {
            display: block;
            width: 100%;
            height: 100%;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            color: inherit;
            background: transparent;
            border: none;
            padding: 0;
            margin: 0;
            white-space: inherit;
            word-wrap: inherit;
        }
        .code-block .keyword, .code-block code .keyword { color: #63b3ed; font-weight: bold; }
        .code-block .type, .code-block code .type { color: #68d391; font-weight: bold; }
        .code-block .function, .code-block code .function { color: #fbb6ce; }
        .code-block .number, .code-block code .number { color: #f6ad55; }
        .code-block .comment, .code-block code .comment { color: #a0aec0; font-style: italic; }
        .code-block .string, .code-block code .string { color: #9ae6b4; }
        .code-block .operator, .code-block code .operator { color: #fbb6ce; font-weight: bold; }
        .code-block .variable, .code-block code .variable { color: #e9c46a; font-weight: 500; }
        .code-block .bracket, .code-block code .bracket { color: #ff6b6b; font-weight: bold; }
        .code-block .symbol, .code-block code .symbol { color: #4ecdc4; font-weight: 500; }
        .code-block .pointer, .code-block code .pointer { color: #ff8a65; font-weight: bold; }
        .code-block .preprocessor, .code-block code .preprocessor { color: #ba68c8; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ§ª è¯­æ³•é«˜äº®æµ‹è¯•é¡µé¢</h1>
    
    <h2>æµ‹è¯•1: åŸå§‹ä»£ç å—ï¼ˆæ— é«˜äº®ï¼‰</h2>
    <pre class="code-block"><code>void build(int l, int r, int u)
{
    if (l == r)
    {
        info[u] = Info(arr[l]);
        return;
    }
    
    int mid = (l + r) >> 1;
    build(l, mid, u << 1);
    build(mid + 1, r, u << 1 | 1);
    push_up(u);
}</code></pre>

    <h2>æµ‹è¯•2: æ‰‹åŠ¨é«˜äº®çš„ä»£ç å—</h2>
    <pre class="code-block"><code><span class="keyword">void</span> <span class="function">build</span><span class="bracket">(</span><span class="type">int</span> <span class="variable">l</span><span class="symbol">,</span> <span class="type">int</span> <span class="variable">r</span><span class="symbol">,</span> <span class="type">int</span> <span class="variable">u</span><span class="bracket">)</span>
<span class="bracket">{</span>
    <span class="keyword">if</span> <span class="bracket">(</span><span class="variable">l</span> <span class="operator">==</span> <span class="variable">r</span><span class="bracket">)</span>
    <span class="bracket">{</span>
        <span class="variable">info</span><span class="bracket">[</span><span class="variable">u</span><span class="bracket">]</span> <span class="operator">=</span> <span class="type">Info</span><span class="bracket">(</span><span class="variable">arr</span><span class="bracket">[</span><span class="variable">l</span><span class="bracket">])</span><span class="symbol">;</span>
        <span class="keyword">return</span><span class="symbol">;</span>
    <span class="bracket">}</span>
    
    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> <span class="bracket">(</span><span class="variable">l</span> <span class="operator">+</span> <span class="variable">r</span><span class="bracket">)</span> <span class="operator">>></span> <span class="number">1</span><span class="symbol">;</span>
    <span class="function">build</span><span class="bracket">(</span><span class="variable">l</span><span class="symbol">,</span> <span class="variable">mid</span><span class="symbol">,</span> <span class="variable">u</span> <span class="operator"><<</span> <span class="number">1</span><span class="bracket">)</span><span class="symbol">;</span>
    <span class="function">build</span><span class="bracket">(</span><span class="variable">mid</span> <span class="operator">+</span> <span class="number">1</span><span class="symbol">,</span> <span class="variable">r</span><span class="symbol">,</span> <span class="variable">u</span> <span class="operator"><<</span> <span class="number">1</span> <span class="operator">|</span> <span class="number">1</span><span class="bracket">)</span><span class="symbol">;</span>
    <span class="function">push_up</span><span class="bracket">(</span><span class="variable">u</span><span class="bracket">)</span><span class="symbol">;</span>
<span class="bracket">}</span></code></pre>

    <h2>æµ‹è¯•3: JavaScript è‡ªåŠ¨é«˜äº®</h2>
    <div id="auto-highlighted">
        <pre class="code-block"><code>void build(int l, int r, int u)
{
    if (l == r)
    {
        info[u] = Info(arr[l]);
        return;
    }
    
    int mid = (l + r) >> 1;
    build(l, mid, u << 1);
    build(mid + 1, r, u << 1 | 1);
    push_up(u);
}</code></pre>
    </div>

    <script>
        // ç®€åŒ–çš„è¯­æ³•é«˜äº®æµ‹è¯•
        const highlightRules = {
            keywords: ['void', 'int', 'if', 'else', 'for', 'while', 'do', 'return', 'struct', 'class'],
            types: ['Info', 'Node', 'vector', 'string'],
            commonVars: ['info', 'arr', 'l', 'r', 'u', 'mid'],
            commentSingle: /(\/\/.*?)(\n|$)/g,
            commentMulti: /(\/\*[\s\S]*?\*\/)/g,
            strings: /("(?:[^"\\]|\\.)*")|('(?:[^'\\]|\\.)*')/g,
            numbers: /\b(\d+)\b/g,
            operators: /(<<|>>|<=|>=|==|!=|&&|\|\||[+\-*%=!&|^~<>])/g,
            functions: /\b([a-zA-Z_][a-zA-Z0-9_]*)\s*(?=\()/g,
            brackets: /([(){}\[\]])/g,
            symbols: /([;,.:])/g,
            pointers: /(\*|&)(?=\s*[a-zA-Z_])/g,
            preprocessor: /(#\w+)/g
        };

        function highlightCode(code) {
            let elementIndex = 0;
            const protectedElements = {};

            function protect(content, className) {
                const placeholder = `__ELEMENT_${elementIndex}__`;
                protectedElements[elementIndex++] = `<span class="${className}">${content}</span>`;
                return placeholder;
            }

            // 1. ä¿æŠ¤æ³¨é‡Š
            code = code.replace(highlightRules.commentSingle, (match, comment, ending) => {
                return protect(comment, 'comment') + ending;
            });
            code = code.replace(highlightRules.commentMulti, (match) => {
                return protect(match, 'comment');
            });

            // 2. ä¿æŠ¤å­—ç¬¦ä¸²
            code = code.replace(highlightRules.strings, (match) => {
                return protect(match, 'string');
            });

            // 3. ä¿æŠ¤é¢„å¤„ç†æŒ‡ä»¤
            code = code.replace(highlightRules.preprocessor, (match) => {
                return protect(match, 'preprocessor');
            });

            // 4. é«˜äº®æ•°å­—
            code = code.replace(highlightRules.numbers, (match) => {
                return protect(match, 'number');
            });

            // 5. é«˜äº®æŒ‡é’ˆç¬¦å·
            code = code.replace(highlightRules.pointers, (match) => {
                return protect(match, 'pointer');
            });

            // 6. é«˜äº®æ‹¬å·
            code = code.replace(highlightRules.brackets, (match) => {
                return protect(match, 'bracket');
            });

            // 7. é«˜äº®ç¬¦å·
            code = code.replace(highlightRules.symbols, (match) => {
                return protect(match, 'symbol');
            });

            // 8. é«˜äº®è¿ç®—ç¬¦
            code = code.replace(highlightRules.operators, (match) => {
                return protect(match, 'operator');
            });

            // 9. é«˜äº®å…³é”®å­—
            highlightRules.keywords.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\b(?![^<]*</span>)`, 'g');
                code = code.replace(regex, (match) => {
                    return protect(match, 'keyword');
                });
            });

            // 10. é«˜äº®ç±»å‹
            highlightRules.types.forEach(type => {
                const regex = new RegExp(`\\b${type}\\b(?![^<]*</span>)`, 'g');
                code = code.replace(regex, (match) => {
                    return protect(match, 'type');
                });
            });

            // 11. é«˜äº®å‡½æ•°å
            code = code.replace(highlightRules.functions, (match, funcName) => {
                return protect(funcName, 'function') + match.substring(funcName.length);
            });

            // 12. é«˜äº®å¸¸è§å˜é‡å
            highlightRules.commonVars.forEach(varName => {
                const regex = new RegExp(`\\b${varName}\\b(?!\\s*\\()(?![^<]*</span>)`, 'g');
                code = code.replace(regex, (match) => {
                    return protect(match, 'variable');
                });
            });

            // æ¢å¤æ‰€æœ‰ä¿æŠ¤çš„å…ƒç´ 
            for (const [index, element] of Object.entries(protectedElements)) {
                code = code.replace(`__ELEMENT_${index}__`, element);
            }

            return `<code>${code}</code>`;
        }

        // åº”ç”¨è¯­æ³•é«˜äº®åˆ°æµ‹è¯•3
        document.addEventListener('DOMContentLoaded', () => {
            const testBlock = document.querySelector('#auto-highlighted .code-block');
            if (testBlock) {
                const codeTag = testBlock.querySelector('code');
                if (codeTag) {
                    const originalCode = codeTag.textContent;
                    const highlightedCode = highlightCode(originalCode);
                    codeTag.innerHTML = highlightedCode.replace('<code>', '').replace('</code>', '');
                }
            }
        });
    </script>
</body>
</html>
